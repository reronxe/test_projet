<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Enregistrement Vocal</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #121212;
      color: #e0e0e0;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    .recorder-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2rem;
      background: #1e1e1e;
      border-radius: 20px;
      padding: 2.5rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
      max-width: 400px;
      width: 90%;
    }

    .microphone {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: linear-gradient(145deg, #6200ee, #3700b3);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }

    .microphone:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
    }

    .microphone.recording {
      background: linear-gradient(145deg, #ff0000, #cc0000);
      animation: pulse 1.5s infinite;
    }

    .microphone-icon {
      font-size: 40px;
      color: white;
    }

    .status {
      font-size: 1.2rem;
      text-align: center;
      min-height: 30px;
    }

    .timer {
      font-size: 1.5rem;
      font-weight: bold;
      margin: 10px 0;
    }

    .audio-playback {
      width: 100%;
      margin-top: 20px;
    }

    .download-link {
      display: inline-block;
      margin-top: 15px;
      padding: 10px 15px;
      background-color: #6200ee;
      color: white;
      text-decoration: none;
      border-radius: 5px;
      transition: background-color 0.3s;
    }

    .download-link:hover {
      background-color: #3700b3;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7);
      }
      70% {
        transform: scale(1.05);
        box-shadow: 0 0 0 15px rgba(255, 0, 0, 0);
      }
      100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(255, 0, 0, 0);
      }
    }
  </style>
</head>
<body>
  <div class="recorder-container">
    <h1>Enregistreur Vocal</h1>
    
    <div class="microphone" id="microphone">
      <div class="microphone-icon">üéôÔ∏è</div>
    </div>
    
    <div class="timer" id="timer">00:00</div>
    <div class="status" id="status">Cliquez sur le micro pour commencer l'enregistrement</div>
    
    <audio class="audio-playback" id="audioPlayback" controls></audio>
    <a id="downloadLink" class="download-link" href="#" style="display:none;">T√©l√©charger l'audio</a>
  </div>

  <script>
    const microphone = document.getElementById('microphone');
    const status = document.getElementById('status');
    const timer = document.getElementById('timer');
    const audioPlayback = document.getElementById('audioPlayback');
    const downloadLink = document.getElementById('downloadLink');

    let mediaRecorder;
    let audioChunks = [];
    let recording = false;
    let startTime;
    let timerInterval;

    // Fonction pour d√©marrer le chronom√®tre
    function startTimer() {
      startTime = Date.now();
      timerInterval = setInterval(updateTimer, 1000);
    }

    // Fonction pour mettre √† jour le chronom√®tre
    function updateTimer() {
      const elapsedTime = Date.now() - startTime;
      const seconds = Math.floor(elapsedTime / 1000);
      const minutes = Math.floor(seconds / 60);
      
      timer.textContent = `${minutes.toString().padStart(2, '0')}:${(seconds % 60).toString().padStart(2, '0')}`;
    }

    // Fonction pour arr√™ter le chronom√®tre
    function stopTimer() {
      clearInterval(timerInterval);
      timer.textContent = '00:00';
    }

    // Fonction pour d√©marrer l'enregistrement
    async function startRecording() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        
        mediaRecorder.ondataavailable = (event) => {
          audioChunks.push(event.data);
        };
        
        mediaRecorder.onstop = () => {
          const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
          const audioUrl = URL.createObjectURL(audioBlob);
          
          audioPlayback.src = audioUrl;
          downloadLink.href = audioUrl;
          downloadLink.download = `enregistrement-${new Date().toISOString()}.webm`;
          downloadLink.style.display = 'inline-block';
        };
        
        audioChunks = [];
        mediaRecorder.start();
        recording = true;
        microphone.classList.add('recording');
        status.textContent = 'Enregistrement en cours...';
        startTimer();
        
      } catch (error) {
        console.error("Erreur d'acc√®s au microphone:", error);
        status.textContent = "Erreur: Impossible d'acc√©der au microphone";
      }
    }

    // Fonction pour arr√™ter l'enregistrement
    function stopRecording() {
      if (mediaRecorder && recording) {
        mediaRecorder.stop();
        recording = false;
        microphone.classList.remove('recording');
        status.textContent = 'Enregistrement termin√©. √âcoutez votre audio ci-dessous.';
        stopTimer();
        
        // Arr√™ter tous les tracks du stream
        mediaRecorder.stream.getTracks().forEach(track => track.stop());
      }
    }

    // Gestionnaire d'√©v√©nement pour le microphone
    microphone.addEventListener('click', () => {
      if (!recording) {
        startRecording();
      } else {
        stopRecording();
      }
    });

    // V√©rification de la compatibilit√©
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
      status.textContent = "Votre navigateur ne supporte pas l'enregistrement audio";
      microphone.style.opacity = "0.5";
      microphone.style.cursor = "not-allowed";
    }
  </script>
</body>
</html>
